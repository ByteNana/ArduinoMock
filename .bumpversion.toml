[tool.bumpversion]
current_version = "0.2.0-rc.1"
parse = '(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)(-(?P<pre_l>rc)\.(?P<pre_n>\d+))?'
serialize = [
    "{major}.{minor}.{patch}-{pre_l}.{pre_n}",
    "{major}.{minor}.{patch}",
]
commit = false
tag = false

[tool.bumpversion.parts.pre_l]
values = ["final", "rc"]
optional_value = "final"

[tool.bumpversion.parts.pre_n]
first_value = "1"

# File 1: project VERSION (major.minor.patch only)
[[tool.bumpversion.files]]
filename = "CMakeLists.txt"
search = "project(ArduinoNativeMocks VERSION {current_version}"
replace = "project(ArduinoNativeMocks VERSION {new_version}"
serialize = ["{major}.{minor}.{patch}"]

# File 2a: PROJECT_VERSION_SUFIX — update suffix during rc bumps
[[tool.bumpversion.files]]
filename = "CMakeLists.txt"
regex = true
search = 'set\(PROJECT_VERSION_SUFIX "[^"]*"\)'
replace = 'set(PROJECT_VERSION_SUFIX "-rc.{new_pre_n}")'
include_bumps = ["pre_n", "pre_l"]

# File 2b: PROJECT_VERSION_SUFIX — clear suffix for final releases
[[tool.bumpversion.files]]
filename = "CMakeLists.txt"
regex = true
search = 'set\(PROJECT_VERSION_SUFIX "[^"]*"\)'
replace = 'set(PROJECT_VERSION_SUFIX "")'
include_bumps = ["patch", "minor", "major"]
